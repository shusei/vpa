/* =========================
   VPA — Clean Theming + Settings
   固定標準模式；齒輪在整個系統大框（.container）右上
   ========================= */

/* ---------- Base tokens（預設 Warm） ---------- */
:root{
  --bg-start:#2b1e20; --bg-end:#171112;

  --surface:rgba(46,33,36,.60);
  --surface-strong:rgba(46,33,36,.80);
  --panel:#fffaf7;
  --panel-border:#eadbd5;

  --text:#f7f2f4; --muted:#cbbec3; --ink:#2c1f22;

  --accent-1:#f6a6c1; --accent-2:#f6c28b;
  --accent: color-mix(in oklab, var(--accent-1) 58%, var(--accent-2) 42%);

  --ring:#ffd39e; --border:#3a2a2e;

  --female:#f3accf; --male:#ffc0a8;

  --link: color-mix(in oklab, #ffe7c7 55%, var(--accent) 45%);
}

/* ---------- 題庫主題 ---------- */
html[data-theme="warm"]{} /* default */

html[data-theme="lavender"]{
  --bg-start:#2a1f35; --bg-end:#14101c;
  --surface:rgba(42,31,53,.60); --surface-strong:rgba(42,31,53,.80);
  --panel:#f9f6ff; --panel-border:#e6dcff;
  --text:#f2edff; --muted:#cfc5e6; --ink:#1c1430;
  --accent-1:#c9a7ff; --accent-2:#9bb8ff;
  --accent: color-mix(in oklab, var(--accent-1) 65%, var(--accent-2) 35%);
  --ring:#c7b8ff; --border:#3a2e4c; --link:#6b5bd6;
  --female:#c7b8ff; --male:#ffb3c7;
}

html[data-theme="peach"]{
  --bg-start:#3a2220; --bg-end:#1a1110;
  --surface:rgba(58,34,32,.60); --surface-strong:rgba(58,34,32,.80);
  --panel:#fff6f1; --panel-border:#ffe2d3;
  --text:#fbeeea; --muted:#e3c8c1; --ink:#2a1614;
  --accent-1:#ffb4a2; --accent-2:#ffd6a5;
  --accent: color-mix(in oklab, var(--accent-1) 55%, var(--accent-2) 45%);
  --ring:#ffc8a4; --border:#4a2b28; --link:#b45309;
  --female:#ffb7cc; --male:#ffd0b3;
}

html[data-theme="ink"]{
  --bg-start:#1b1c21; --bg-end:#0e0f12;
  --surface:rgba(32,33,40,.60); --surface-strong:rgba(32,33,40,.80);
  --panel:#f8f9fb; --panel-border:#e5e7eb;
  --text:#eef1f7; --muted:#b9bfcb; --ink:#0e1320;
  --accent-1:#a3b8ff; --accent-2:#9ee0ff;
  --accent: color-mix(in oklab, var(--accent-1) 50%, var(--accent-2) 50%);
  --ring:#9ec1ff; --border:#2a2c34; --link:#1d4ed8;
  --female:#9bb7ff; --male:#ffb2b2;
}

html[data-theme="day"]{
  --bg-start:#ffffff; --bg-end:#fafafa;
  --surface:rgba(255,255,255,.72); --surface-strong:rgba(255,255,255,.88);
  --panel:#ffffff; --panel-border:#e5e7eb;
  --text:#0f172a; --muted:#4b5563; --ink:#0f172a;
  --accent-1:#f0abfc; --accent-2:#7dd3fc;
  --accent: color-mix(in oklab, var(--accent-1) 55%, var(--accent-2) 45%);
  --ring:#60a5fa; --border:#e5e7eb; --link:#2563eb;
  --female:#93c5fd; --male:#fda4af;
}

html[data-theme="night"]{
  --bg-start:#111827; --bg-end:#0b1220;
  --surface:rgba(17,24,39,.55); --surface-strong:rgba(17,24,39,.75);
  --panel:#141a24; --panel-border:#243041;
  --text:#e7ebf3; --muted:#a9b1c3; --ink:#e7ebf3;
  --accent-1:#c084fc; --accent-2:#22d3ee;
  --accent: color-mix(in oklab, var(--accent-1) 60%, var(--accent-2) 40%);
  --ring:#7dd3fc; --border:#243041; --link:#93c5fd;
  --female:#93b5ff; --male:#ff9aa2;
}

html[data-theme="contrast"]{
  --bg-start:#000; --bg-end:#000;
  --surface:rgba(0,0,0,.85); --surface-strong:rgba(0,0,0,.92);
  --panel:#fff; --panel-border:#000;
  --text:#fff; --muted:#d1d5db; --ink:#000;
  --accent-1:#000; --accent-2:#000; --accent:#111;
  --ring:#ffbf00; --border:#000; --link:#0a58ff;
  --female:#0ea5e9; --male:#ef4444;
}

/* ---------- Base / Reset ---------- */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0; color:var(--text);
  background: radial-gradient(1200px 600px at 50% -10%, var(--bg-start), var(--bg-end));
  font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", Segoe UI, Roboto, "Noto Sans TC", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
}
a{ color: var(--link); text-decoration:none; }
a:hover{ text-decoration:underline; }
a:focus-visible{ outline:none; box-shadow:0 0 0 3px var(--ring); border-radius:8px; }

.hidden{ display:none !important; }
.mt-10{ margin-top:10px; }

/* ---------- Layout ---------- */
.container{
  position:relative;            /* 讓齒輪絕對定位在容器內 */
  max-width:880px;
  margin:clamp(32px,10vh,120px) auto;
  padding:28px clamp(18px,3vw,36px);
  border-radius:24px;
}
.backdrop{
  background:var(--surface);
  backdrop-filter:saturate(118%) blur(14px);
  -webkit-backdrop-filter:saturate(118%) blur(14px);
  border:1px solid var(--border); box-shadow:0 24px 80px rgba(0,0,0,.35);
  border-radius:24px;
}

/* ---------- Heading ---------- */
.hero-title{
  margin:0 0 10px; font-weight:800; letter-spacing:.2px; line-height:1.15;
  display:flex; align-items:center; gap:10px;
  background:linear-gradient(90deg,#fff, color-mix(in oklab,var(--accent-1) 70%,#fff 30%) 40%, color-mix(in oklab,var(--accent-2) 40%,#fff 60%) 85%);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  font-size:clamp(24px,4.2vw,36px);
}
.subline{ margin-top:6px; font-size:13px; color:var(--muted); }

/* ---------- Chips ---------- */
.trust-row{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:18px; }
.chip{
  display:inline-flex; align-items:center; gap:6px; font-size:12px;
  padding:6px 10px; border-radius:999px; border:1px solid var(--border);
  background:var(--surface-strong); color:var(--text);
}
.chip.beta{
  font-weight:700; color: color-mix(in oklab, var(--ink) 90%, #000 10%);
  background:linear-gradient(135deg, color-mix(in oklab,var(--accent-1) 72%,#fff 28%), color-mix(in oklab,var(--accent-2) 38%,#fff 62%));
  box-shadow:0 6px 14px color-mix(in oklab,var(--accent-2) 30%, #000 70%);
}
.chip.local{
  font-weight:800; color: color-mix(in oklab, var(--ink) 95%, #000 5%); border:none;
  background:linear-gradient(135deg, color-mix(in oklab,var(--accent) 86%,#fff 10%), color-mix(in oklab,var(--accent-2) 30%,#fff 70%));
  box-shadow:0 8px 18px color-mix(in oklab,var(--accent-2) 25%, #000 75%);
}

/* ---------- Settings（齒輪 + 選單） ---------- */
.settings-btn{
  position:absolute; top:12px; right:12px;
  display:grid; place-items:center; width:34px; height:34px;
  border-radius:10px; border:1px solid var(--panel-border);
  background:var(--panel); color:var(--ink);
  box-shadow:0 6px 18px rgba(0,0,0,.12);
  cursor:pointer; z-index:30;
}
.settings-btn:hover{ filter:brightness(1.05); }
.settings-btn:focus-visible{ outline:none; box-shadow:0 0 0 3px var(--ring); }

.theme-menu{
  position:absolute; top:52px; right:12px; z-index:40;
  min-width: 200px; padding:8px; border-radius:12px;
  border:1px solid var(--panel-border); background:var(--panel); color:var(--ink);
  box-shadow:0 20px 40px rgba(0,0,0,.18);
}
.theme-menu[hidden]{ display:none; }
.theme-menu__title{ font-size:12px; letter-spacing:.4px; color:var(--muted); margin:4px 6px 8px; }
.theme-item{
  display:flex; align-items:center; gap:10px;
  width:100%; text-align:left; border:none; background:transparent;
  padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600;
}
.theme-item[aria-checked="true"]{ outline:2px solid var(--ring); }
.theme-item:hover{ background: color-mix(in oklab, var(--panel) 80%, var(--accent-2) 20%); }
.swatch{ width:18px; height:18px; border-radius:6px; border:1px solid var(--panel-border); }
.swatch--warm{ background:linear-gradient(135deg,#f6a6c1,#f6c28b); }
.swatch--lavender{ background:linear-gradient(135deg,#c9a7ff,#9bb8ff); }
.swatch--peach{ background:linear-gradient(135deg,#ffb4a2,#ffd6a5); }
.swatch--ink{ background:linear-gradient(135deg,#a3b8ff,#9ee0ff); }
.swatch--day{ background:linear-gradient(135deg,#f0abfc,#7dd3fc); }
.swatch--night{ background:linear-gradient(135deg,#c084fc,#22d3ee); }
.swatch--contrast{ background:linear-gradient(135deg,#000,#fff); }

/* ---------- Start ---------- */
.start-wrap{ margin-top:6px; }

/* ---------- Record button ---------- */
.record-btn{
  width:100%; padding:22px; font-size:clamp(18px,2.6vw,22px);
  border-radius:18px; border:1px solid var(--border); color:#fffdfc;
  text-shadow:0 1px 1px rgba(0,0,0,.45); cursor:pointer;
  transition:transform .06s ease, filter .25s ease, box-shadow .25s ease;
  background:
    linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06)),
    linear-gradient(135deg, color-mix(in oklab, var(--accent) 62%, #000 38%), color-mix(in oklab, var(--bg-start) 70%, #000 30%));
  box-shadow:0 16px 40px rgba(0,0,0,.28);
}
.record-btn:hover{ transform:translateY(-1px); filter:brightness(1.06); }
.record-btn:focus-visible{ outline:none; box-shadow:0 0 0 3px var(--ring); }
.record-btn .rec{ display:none; }
.recording .record-btn .idle{ display:none; }
.recording .record-btn .rec{ display:inline; }

/* ---------- Status ---------- */
.status{ margin-top:12px; color:var(--muted); font-size:14px; }

/* ---------- Player（亮底卡片） ---------- */
.player{
  margin-top:18px; padding:16px; border-radius:16px;
  background:var(--panel); border:1px solid var(--panel-border);
  color:var(--ink); display:flex; align-items:center; gap:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
}
#playBtn{
  padding:10px 14px; border-radius:999px; border:none; font-weight:700; letter-spacing:.2px; cursor:pointer;
  background:linear-gradient(135deg, color-mix(in oklab, var(--accent) 88%, #fff 6%), color-mix(in oklab, var(--accent-2) 35%, #fff 65%));
  color: color-mix(in oklab, var(--ink) 90%, #000 10%);
  box-shadow:0 6px 18px rgba(0,0,0,.12);
  transition:transform .06s ease, filter .2s ease, opacity .2s ease;
  opacity:.95;
}
#playBtn:hover{ transform:translateY(-1px); filter:brightness(1.06); }
.player .hint{ color:var(--ink); font-size:13px; }
.player .hint a{ color: color-mix(in oklab, var(--accent-2) 60%, var(--accent-1) 40%); text-decoration:underline; font-weight:800; padding:0 2px; border-radius:4px; }

/* ---------- Meter ---------- */
.meter{ margin-top:24px; display:grid; gap:14px; }
.meter.hidden{ display:none; }
.bar{
  position:relative; height:48px; background:var(--surface); border-radius:14px; overflow:hidden; border:1px solid var(--border);
}
.bar::before{
  content:""; position:absolute; inset:0; transform:scaleX(var(--p,0)); transform-origin:left;
  transition:transform .35s ease; background:linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
}
.bar.female::before{ background:linear-gradient(90deg, color-mix(in oklab, var(--female) 80%, #fff 6%), transparent); }
.bar.male::before{ background:linear-gradient(90deg, color-mix(in oklab, var(--male) 80%, #fff 6%), transparent); }
.bar .label{ position:absolute; left:12px; top:10px; font-weight:700; letter-spacing:.3px; }
.bar .value{ position:absolute; right:12px; top:10px; font-variant-numeric: tabular-nums; }

/* ---------- Upload FAB ---------- */
.fab{
  position:fixed; right:24px; bottom:24px; width:56px; height:56px; display:grid; place-items:center;
  border-radius:50%; cursor:pointer; border:1px solid var(--border);
  background:var(--surface-strong); color:var(--text); box-shadow:0 12px 30px rgba(0,0,0,.35);
  font-size:20px; transition:transform .06s ease, filter .25s ease, box-shadow .25s ease;
}
.fab:hover{ transform:translateY(-1px); filter:brightness(1.06); }
.fab:focus-within{ box-shadow:0 0 0 3px var(--ring); }

/* ---------- Info ---------- */
.info{ margin-top:24px; }
details{
  background:var(--surface); border:1px solid var(--border); border-radius:14px;
  padding:12px 14px; margin-top:12px; box-shadow:0 10px 30px rgba(0,0,0,.20);
}
details > summary{
  cursor:pointer; font-weight:700; letter-spacing:.2px;
  color: color-mix(in oklab, var(--text) 92%, var(--accent-1) 8%);
  list-style:none;
}
details > summary::-webkit-details-marker{ display:none; }
details[open] > summary{ margin-bottom:6px; }
.bullets{ margin:6px 0 0 0; padding-left:18px; }
.bullets li{ margin:6px 0; color: color-mix(in oklab, var(--text) 85%, var(--accent-2) 15%); }

/* ---------- Key-value grid ---------- */
.kv{ display:grid; grid-template-columns:max-content 1fr; gap:8px 12px; align-items:start; }

/* ---------- Reduced motion ---------- */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}

/* ---------- Small screens ---------- */
@media (max-width:420px){
  .bar{ height:44px; }
  .record-btn{ padding:18px; }
}
