<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0b0c10" />
    <title>Voice Presentation Analyzer — Browser-only</title>
    <meta name="description" content="在瀏覽器端本地推論，回饋『模型感知的女性化／男性化傾向』。隱私優先，不上傳音檔，請以多次測試的趨勢為準。">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://huggingface.co" crossorigin>
    <link rel="icon" type="image/svg+xml"
      href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="%23c084fc"/><stop offset="1" stop-color="%2322d3ee"/></linearGradient></defs><rect width="96" height="96" rx="18" fill="%23151922"/><circle cx="32" cy="40" r="10" fill="url(%23g)"/><circle cx="64" cy="56" r="10" fill="url(%23g)"/><path d="M20 70c24-12 32-12 56 0" stroke="url(%23g)" stroke-width="6" fill="none" stroke-linecap="round"/></svg>'
    />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <main class="container backdrop">
      <h1 class="hero-title">
        Voice Presentation Analyzer
        <span class="chip beta">練習用</span>
      </h1>

      <div class="trust-row">
        <span class="chip local" title="100% 本地推論">本地推論・不上傳</span>
        <a class="chip link" href="https://huggingface.co/prithivMLmods/Common-Voice-Gender-Detection" target="_blank" rel="noopener">
          模型：Common-Voice-Gender-Detection（ONNX）
        </a>
        <a class="chip link" href="https://github.com/shusei/vpa" target="_blank" rel="noopener">原始碼</a>
      </div>

      <p class="subline">
        溫柔提醒：這裡顯示的是「模型對聲音表現的感知傾向」，不是性別認同的結論。請把它當作練習回饋。
      </p>

      <!-- Record -->
      <button id="recordBtn" class="record-btn" aria-pressed="false">
        <span class="idle">● 開始錄音</span>
        <span class="rec">■ 停止錄音</span>
      </button>

      <p class="subline" style="margin-top:10px;">
        或使用 <b>右下角 ⬆︎</b> 上傳現有音檔（支援 <code>mp3</code> / <code>m4a</code> / <code>mp4</code> / <code>mov</code>）。
      </p>

      <!-- Meter -->
      <div id="meter" class="meter hidden" aria-labelledby="meterTitle">
        <div class="bar female" role="meter" aria-label="女性化傾向" aria-valuemin="0" aria-valuemax="100">
          <span class="label">女性化傾向</span>
          <span class="value" id="femaleVal">—</span>
        </div>
        <div class="bar male" role="meter" aria-label="男性化傾向" aria-valuemin="0" aria-valuemax="100">
          <span class="label">男性化傾向</span>
          <span class="value" id="maleVal">—</span>
        </div>
      </div>

      <!-- Status -->
      <div id="status" class="status" aria-live="polite">準備就緒</div>

      <!-- Player gets injected before this callout by app.js -->
      <div class="callout soft">
        <strong>提示：</strong> 40–60% 是正常的灰色帶，建議多錄幾段、看趨勢而不是只看一次。
      </div>

      <!-- Info -->
      <section class="info">
        <details open>
          <summary>如何錄比較準？（快速）</summary>
          <ul class="bullets">
            <li>錄 <b>5–10 秒「說話」</b>（非唱歌），環境安靜、避免背景音與回音。</li>
            <li>麥克風距離 <b>10–15 cm</b>，平常對話音量與語速。</li>
            <li>要上傳既有錄音：點右下角 <b>⬆︎</b>（支援 mp3/m4a/mp4/mov）。</li>
            <li>iPhone 語音備忘錄：先「分享 → 存到檔案 (Files)」，回本頁選「瀏覽」上傳。</li>
          </ul>
        </details>

        <details>
          <summary>模型概覽</summary>
          <div class="kv">
            <div>名稱：</div>
            <div><a href="https://huggingface.co/prithivMLmods/Common-Voice-Gender-Detection" target="_blank" rel="noopener">Common-Voice-Gender-Detection</a>（ONNX）</div>
            <div>架構：</div>
            <div>Wav2Vec2（<a href="https://arxiv.org/pdf/2006.11477" target="_blank" rel="noopener">Self-Supervised Learning for Speech Recognition</a>）</div>
            <div>標籤空間：</div><div>二分類（<code>female</code> / <code>male</code>）</div>
            <div>來源資料：</div><div>Mozilla Common Voice 等語料（以英語朗讀為主）</div>
            <div>授權：</div><div>Apache-2.0（模型）；本頁程式碼依你的 repo 授權</div>
            <div>DOI：</div><div><a href="https://doi.org/10.57967/hf/5684" target="_blank" rel="noopener">10.57967/hf/5684</a></div>
          </div>
        </details>

        <details>
          <summary>準確度（開發者報告）</summary>
          <ul class="bullets" style="margin-top:6px;">
            <li>整體準確率：<b>98.46%</b>（6545 筆）</li>
            <li>female：precision <b>0.9705</b>、recall <b>0.9916</b>、F1 <b>0.9809</b>（2622 筆）</li>
            <li>male：precision <b>0.9943</b>、recall <b>0.9799</b>、F1 <b>0.9870</b>（3923 筆）</li>
          </ul>
          <p class="subline">說明：上述為作者資料分佈下的離線評估；不同語言、環境、內容（如唱歌）可能與此有落差。</p>
        </details>

        <details>
          <summary>方法簡述（本頁實作）</summary>
          <ul class="bullets">
            <li><b>推論引擎：</b>Transformers.js + ONNX Runtime；<b>有 WebGPU 就用 GPU</b>，否則回退 WASM。</li>
            <li><b>前處理（最小化）：</b>立體混單聲道＋<b>16 kHz</b> 重採樣；不去靜音、不調音量。</li>
            <li><b>長檔策略：</b>≤150 秒整段；更長改「串流分段」並 <b>log-odds 加權</b>聚合。</li>
            <li><b>可選 VAD（只「選段」）：</b>偵測語音段落以略過長靜音；<u>不動原音</u>。</li>
            <li><b>隱私：</b>100% 本地推論；音檔不離開裝置。只保留「最新一段」的回放 URL，換檔即釋放。</li>
          </ul>
        </details>

        <details>
          <summary>用途定位與倫理提醒</summary>
          <ul class="bullets">
            <li>定位：自我練習回饋、教學示範、資料標註輔助、研究原型。</li>
            <li>限制：此分數是「模型對聲音表現的傾向」，<b>不是性別認同、醫療或法律判定</b>。</li>
            <li>請勿：用於歧視、排除、或任何影響權益的自動決策。</li>
          </ul>
        </details>

        <details>
          <summary>版本與授權</summary>
          <div class="kv">
            <div>版本：</div><div><code id="ver"></code></div>
            <div>更新：</div><div><code id="updatedAt"></code></div>
            <div>授權：</div><div>模型 <code>Apache-2.0</code>；網站程式碼依你的 repo 授權</div>
            <div>原始碼：</div><div><a href="https://github.com/shusei/vpa" target="_blank" rel="noopener">GitHub / vpa</a></div>
          </div>
        </details>

        <details>
          <summary>相容性與效能</summary>
          <ul class="bullets">
            <li>瀏覽器：近期 Chrome / Edge / Firefox / Safari；<b>開啟 WebGPU 更快</b>。</li>
            <li>格式：audio/*、.m4a、.mp3、.wav、.mp4、.mov（影片僅取音軌）。</li>
            <li>備援：WebAudio 解不動時自動落到 ffmpeg.wasm，轉完即釋放記憶體。</li>
          </ul>
        </details>
      </section>
    </main>

    <!-- Floating upload -->
    <label class="fab" title="上傳音檔（mp3 / m4a / mp4 / mov）" aria-label="上傳音檔（mp3 / m4a / mp4 / mov）">
      ⬆︎
      <input id="fileInput" type="file" accept="audio/*,audio/mp4,video/mp4,video/quicktime,.m4a,.mp4,.mov" hidden />
    </label>

    <!-- App -->
    <script type="module" src="assets/app.js"></script>
  </body>
</html>
